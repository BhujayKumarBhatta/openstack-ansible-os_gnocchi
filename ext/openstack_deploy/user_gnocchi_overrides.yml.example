---
# Copyright 2016, Rackspace US, Inc.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

## This can be used as examples for use in hand-building the necessary overrides
## for now. An improved mechanism for this is pending.

## Describe the gnocchi endpoint used by ceilometer
gnocchi_service_proto: http
gnocchi_service_port: 8041
gnocchi_service_internaluri_proto: "{{ openstack_service_internaluri_proto | default(gnocchi_service_proto) }}"
gnocchi_service_internalurl: "{{ gnocchi_service_internaluri_proto }}://{{ internal_lb_vip_address }}:{{ gnocchi_service_port }}"

## Ensure gnocchiclient is installed on the ceilometer collectors
ceilometer_pip_packages:
  - ceilometer
  - python-ceilometerclient
  - ceilometermiddleware
  - PyMySQL
  - python-memcached
  - pycrypto
  - warlock
  - pymongo
  - tooz
  - libvirt-python
  - gnocchiclient

utility_pip_packages:
  - python-openstackclient
  - python-ceilometerclient
  - python-cinderclient
  - python-glanceclient
  - python-heatclient
  - python-keystoneclient
  - python-neutronclient
  - python-novaclient
  - python-swiftclient
  - python-memcached
  - pycrypto
  - gnocchiclient

## Demonstrating the expected configurations necessary to use gnocchi as the ceilometer dispatcher
## NOTE(stevelle) no support for storing events in gnocchi, so eliminate dispatchers and refuse to store
ceilometer_ceilometer_conf_overrides:
  DEFAULT:
    event_dispatchers: ""
    meter_dispatchers: gnocchi
  collector:
    batch_size: 10
    batch_timeout: 5
  notification:
    store_events: false
  storage:
    max_retries: 80
  dispatcher_gnocchi:
    archive_policy: low

## Demonstrating the expected configurations necessary to use ceph for storage
#    driver: ceph
#    ceph_username: gnocchi
#    ceph_keyring: "/etc/ceph/ceph.client.{{ gnocchi_service_user_name }}.keyring"


## FUTURE(stevelle)
# disable ceilometer-api: https://review.openstack.org/#/c/270818/
